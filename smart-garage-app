/**
 *  Smart Garage
 *
 *  Author: wbornor@gmail.com
 *  Date: 2014-03-10
 */

definition(
    name: "Smart Garage App",
    namespace: "",
    author: "wbornor@gmail.com",
    description: "Control Garage Lights and Doors",
    category: "My Apps",
    iconUrl: "https://s3.amazonaws.com/smartapp-icons/Convenience/Cat-Convenience.png",
    iconX2Url: "https://s3.amazonaws.com/smartapp-icons/Convenience/Cat-Convenience%402x.png",
    oauth: true)

preferences {
	section("When 'C' is pressed on the remote.") {
        input "shield", "capability.momentary"
	}
    section("Exterior Garage Lights") {
        input "exteriorLights", "capability.switch"
	}
    section("Interior Garage Lights") {
        input "interiorLights", "capability.switch"
	}
    /*section("When 'D' is pressed on the remote.") {
        input "shield", "capability.switch "
	}*/
}


def installed() {
	log.debug "Installed with settings: ${settings}"

	initialize()
}

def updated() {
	log.debug "Updated with settings: ${settings}"

	unsubscribe()
	initialize()
}

def initialize() {
    //subscribe(shield, "switch", shieldHandler)
    subscribe(shield, "momentary", shieldHandler)
    subscribe(shield, "switch", shieldHandler)
    //subscribe(shieldD, "switch", rightDoorHandler)
}

def shieldHandler(event) {
	log.debug "shieldHandler - event.name: $event.name, event.value: $event.value"
    if (event.value == "pushed"){
        def interiorLightsState = interiorLights.currentState("switch")
        log.debug "shieldHandler - interiorLightsState.value: $interiorLightsState.value"
        if (interiorLightsState.value == "off") {
            interiorLights.on()
            log.debug "shieldHandler - sent on"
        } else if (interiorLightsState.value == "on") {
            interiorLights.off()
            log.debug "shieldHandler - sent off"
        }
    }
    if (event.value == "on" || event.value == "off" ){
        def exteriorLightsState = exteriorLights.currentState("switch")
        log.debug "shieldHandler - exteriorLightsState.value: $exteriorLightsState.value"
        if (exteriorLightsState.value == "off") {
            exteriorLights.on()
            log.debug "shieldHandler - sent on"
        } else if (exteriorLightsState.value == "on") {
            exteriorLights.off()
            log.debug "shieldHandler - sent off"
        }
    }
}

/*def rightDoorHandler(event) {
	log.debug "rightDoorHandler - event.name: $event.name, event.value: $event.value"
    
}*/
